<!--
 * @Author: LinFeng
 * @LastEditors: LinFeng
 * @Date: 2020-07-25 22:17:51
 * @LastEditTime: 2020-08-02 12:27:33
 * @FilePath: /react-elm/å­¦ä¹ ç¬”è®°.md
 * @Description:
-->

## 2020.7.25

### router å†…é‡å®šå‘åˆ°æŸä¸ªåœ°å€å¯ä»¥è·³è½¬, ä½†æ˜¯åœ¨æµè§ˆå™¨ç›´æ¥åˆ·æ–°å´ä¼š 404

https://segmentfault.com/q/1010000010844476

ä¹‹æ‰€ä»¥ä½ åœ¨æµè§ˆå™¨å†…å¯ä»¥ç”±é¦–é¡µè·³è½¬åˆ°å…¶ä»–è·¯ç”±åœ°å€ï¼Œæ˜¯å› ä¸ºè¿™æ˜¯ç”±å‰ç«¯è‡ªè¡Œæ¸²æŸ“çš„ï¼Œä½ åœ¨ React Router å®šä¹‰äº†å¯¹åº”çš„è·¯ç”±ï¼Œè„šæœ¬å¹¶æ²¡æœ‰åˆ·æ–°ç½‘é¡µè®¿é—®åå°ï¼Œæ˜¯ JS åŠ¨æ€æ›´æ”¹äº† locationã€‚

å½“ä½ åˆ·æ–°æ—¶ï¼Œä½ é¦–å…ˆæ˜¯è®¿é—®çš„åå°åœ°å€ï¼Œç„¶åè¿”å›çš„é¡µé¢å†…åŠ è½½äº† React ä»£ç ï¼Œæœ€ååœ¨æµè§ˆå™¨å†…æ‰§è¡Œï¼›ä¹Ÿå°±æ˜¯è¯´å¦‚æœè¿™ä¸ªæ—¶å€™æŠ¥ 404ï¼Œæ˜¯å› ä¸ºä½ åå°å¹¶æ²¡æœ‰é’ˆå¯¹è¿™ä¸ªè·¯ç”±ç»™å‡ºè¿”å› HTML å†…å®¹ï¼Œä¹Ÿè°ˆä¸ä¸Šæ‰§è¡Œ React Router äº†ã€‚

è§£å†³åŠæ³•å°±ä¸€æ¡ï¼šå¦‚æœä½ æœŸæœ›æ‰€æœ‰çš„è·¯ç”±éƒ½ç”± React Router æ¥å®šä¹‰ï¼Œåªæœ‰ä½ çš„åå°ï¼Œæ— è®ºä»»ä½•è·¯å¾„ï¼Œéƒ½è¿”å› index.html å°±å¥½äº†ã€‚å‰©ä¸‹çš„äº‹æƒ…äº¤ç»™ React Routerã€‚é‚£ä¹ˆä½ è¦åšçš„å°±æ˜¯ä¿®æ”¹åå°æœåŠ¡å™¨ï¼Œå¯ä»¥æ”¾åœ¨ apacheï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨ä½ çš„ java è·¯ç”±å†…åšä¸€ä¸ªé€šé…è·¯å¾„å¤„ç†ã€‚

è§£å†³æ–¹æ¡ˆ:

1. å¼€å‘æ—¶, webpack.dev.js:

```javascript
module.exports = merge(webpackCommonConf, {
  mode: "development",
  output: {
    publicPath: "/build/dist/", // ä¿®æ”¹æ‰€æœ‰é™æ€æ–‡ä»¶ url çš„å‰ç¼€
  },
  devServer: {
    historyApiFallback: {
      index: "/build/dist/index.html",
    },
  },
});
```

2. ä¸Šçº¿æ—¶, nginx çš„é…ç½®, å‚è€ƒ

```txt
    server {
    listen 80;
    server_name adminv2.jianliwu.com;
    access_log /etc/nginx/logs/access.log combined;
    index index.html index.jsp index.php;

    location = / {
        root /product/front/admin-v2-fe/dist;
        index index.html;
    }
    location ~ .*\.html$ {
        root /product/front/admin-v2-fe/dist;
        index index.html;
    }
    location ~ .*\.do$ {
        proxy_pass http://admintest.happymmall.com;
    }
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

ç”¨ location é‡å®šå‘

è¿˜æ²¡åˆ°ä¸Šçº¿çš„æ—¶å€™, æ„Ÿè§‰å¯èƒ½è¿˜æœ‰å‘. TODO

## 2020.7.28

### é¦–é¡µçš„æ»šåŠ¨å¤„ç†

#### é¦–é¡µçš„èµ°é©¬ç¯æ¨ªå‘æ»šåŠ¨, chrome æŠ¥é”™

é”™è¯¯ä¸º: [Intervention] Unable to preventDefault inside passive event listener due to target being treated as passive. See <URL>

[å…³äº passive event listener çš„ä¸€æ¬¡è¸©å‘](https://juejin.im/post/5ad804c1f265da504547fe68)

[æ»‘åŠ¨æ—¶å€™è­¦å‘Šï¼šUnable to preventDefault inside passive event listener](https://www.jianshu.com/p/04bf173826aa)

è§£å†³æ–¹æ³•:

ç”±äºèµ°é©¬ç¯æ˜¯ä» antd-mobile å¼•å…¥çš„ç»„ä»¶æ— æ³•ä¿®æ”¹æºç , æ‰€ä»¥ç”¨ css æ–¹æ³•, åœ¨èµ°é©¬ç¯ç»„ä»¶ä¸ŠåŠ ä¸Š css æ ·å¼: [touch-action](https://developer.mozilla.org/zh-CN/docs/Web/CSS/touch-action)

```css
.wrapper {
  touch-action: pan-y; // å…è®¸çš„æ»‘åŠ¨
}
```

#### é¦–é¡µçš„çºµå‘æ»šåŠ¨å¤„ç†:

ä½¿ç”¨åº“: [better-scroll](https://better-scroll.github.io/docs/zh-CN/guide/#betterscroll-%E6%98%AF%E4%BB%80%E4%B9%88)

æ³¨æ„æŸ¥çœ‹[ä½¿ç”¨ better-scroll çš„å¸¸è§é—®é¢˜](https://better-scroll.github.io/docs/zh-CN/FAQ/diagnosis.html), å…¶ä¸­ click äº‹ä»¶æš‚æ—¶æ²¡ç”¨åˆ°, å¯èƒ½éœ€è¦å›å¤´å¡«å‘

ä½¿ç”¨æ–¹æ³•:

```javascript
import BScroll from "better-scroll";
let wrapper = document.querySelector(".wrapper"); // è¦æ±‚.wrapper å®šé«˜
let scroll = new BScroll(wrapper);

// å¦‚æœwrapperé‡Œé¢çš„å†…å®¹é«˜åº¦ä¼šæ”¹å˜ éœ€è¦è°ƒç”¨
scroll.refresh();
```

### èœå•æ»šåŠ¨å®šä½é—®é¢˜, popup éšç€é¡µé¢æ»šåŠ¨, æ»šåŠ¨ç©¿é€

[Select Dropdown DatePicker TimePicker Popover Popconfirm ä¼šè·Ÿéšæ»šåŠ¨æ¡ä¸Šä¸‹ç§»åŠ¨ï¼Ÿ](https://ant.design/docs/react/faq-cn#Select-Dropdown-DatePicker-TimePicker-Popover-Popconfirm-%E4%BC%9A%E8%B7%9F%E9%9A%8F%E6%BB%9A%E5%8A%A8%E6%9D%A1%E4%B8%8A%E4%B8%8B%E7%A7%BB%E5%8A%A8%EF%BC%9F)

[è§£å†³ç§»åŠ¨ç«¯æ»šåŠ¨ç©¿é€](https://juejin.im/post/5c4974f0518825260c5d1851)

[æ»šåŠ¨ç©¿é€é—®é¢˜æ¢ç´¢](https://juejin.im/post/5c49bc74e51d4504314306e6)

åœ¨ src/page/shop-category/components/options-cascader ä¸­å‡ºç°è¯¥é—®é¢˜, è§£å†³æ–¹æ³•å¦‚ç¬¬ä¸€ä¸ªé“¾æ¥, ä¸º popup è®¾ç½®ç›®æ ‡å®¹å™¨

```javascript
<div
    style={{
    position: "fixed",
    zIndex: 100,
    top: "90px",
    bottom: 0,
    background: "rgba(0, 0, 0, 0)",
    width: "100%",
    }}
    id="popuparea"
/>
<div className="options-cascader-wrapper">
<Cascader getPopupContainer={() => document.getElementById("popuparea")} />
```

## 2020.7.29

### antd Select ç»„ä»¶ popup çš„ä½ç½®è°ƒæ•´

antd Select çš„ popup é»˜è®¤å·¦è¾¹ç¼˜å¯¹é½, å¹¶ä¸”å®˜ç½‘æ²¡æœ‰ç»™å‡ºä¿®æ”¹æŒ‡å¯¼, ä½†æ˜¯çš„ç¡®å­˜åœ¨å±æ€§å¯ä»¥ä¿®æ”¹, å®ƒç”¨çš„[react-component/select](https://github.com/react-component/select)

æŸ¥çœ‹ issue: [Adjusting the position offset of the dropdown?](https://github.com/react-component/select/issues/254#issuecomment-352367451), çœ‹ä¸‹è¿™ä¸ªé“¾æ¥é‡Œç»™å‡ºçš„ä¸¤ä¸ªé“¾æ¥å°±æ˜ç™½äº†

è§£å†³æ–¹æ³•:

```javascript
<Select
  dropdownAlign={{
    points: ["tr", "br"],
    offset: [0, 0],
  }}
></Select>
```

### redux, react-redux çš„æ•°æ®æµ

https://segmentfault.com/q/1010000013175270

[Data Flow](https://redux.js.org/basics/data-flow), æ³¨æ„è¿™ä¸ªé“¾æ¥å†…çš„é åçš„ä¸€è¡Œå­—, If you use bindings like React Redux, this is the point at which component.setState(newState) is called.

è¦ç†è§£, redux å†…çš„ store åœ¨æ¥æ”¶åˆ° action å, redux çš„ store å†…çš„æ•°æ®æ˜¯åŒæ­¥æ›´æ–°çš„,ä½†æ˜¯ç»„ä»¶å†…è¦è·å–æ–°çš„ state éœ€è¦é‡æ–°è°ƒç”¨ getState, è€Œ react-redux ä¸­çš„ connect, æ˜¯å°†ç»„ä»¶åŒ…è£…æˆé«˜é˜¶ç»„ä»¶(HOC), åŸç»„ä»¶é€šè¿‡é«˜é˜¶ç»„ä»¶ç»™å®ƒä¼ é€’çš„ props è·å–éœ€è¦çš„æ•°æ®,æ‰€ä»¥åªèƒ½ç­‰å¾… props æ›´æ–°, æ‰€ä»¥è¦è·å–"åŒæ­¥"è·å–æ–°å€¼,éœ€è¦ç”¨åˆ°æœ‰å…³ props çš„ç”Ÿå‘½å‘¨æœŸ, getDerivedStateFromProps, UNSAFE_componentWillReceiveProps

## 2020.7.31

### sass çš„å…¨å±€å˜é‡å¼•å…¥

ä½¿ç”¨ webpack é…ç½®[sass-resources-loader](https://github.com/shakacode/sass-resources-loader)

### vscode webpack chrome è°ƒè¯• react

å®‰è£… debugger for chrome

é…ç½®è¿‡ç¨‹:
vscode debug çš„ launch.json

```json
{
  // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚
  // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚
  // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387
  "version": "0.2.0",
  "configurations": [
    {
      "type": "chrome",
      "request": "launch", // launch æˆ–è€… attach, æ¨èlaunch
      "name": "attach Chrome against localhost",
      "url": "http://localhost:8787", // webpack dev server çš„æœåŠ¡åœ°å€
      "webRoot": "${workspaceFolder}", // è·¯å¾„é…ç½®
      "skipFiles": ["node_modules"],
      // å…³é”®æ˜¯è¿™é‡Œ, è®¾ç½®launchçš„chromeçš„ç”¨æˆ·æ•°æ®è·¯å¾„, å¯ä»¥å®‰è£…react devtool, redux devtool, è¿™æ ·æ¯æ¬¡é‡å¼€ä¸ä¼šä¸¢å¤±æ’ä»¶
      "userDataDir": "${workspaceFolder/.vscode/chrome-debugger}",
      "sourceMapPathOverrides": {
        // è·¯å¾„é…ç½®
        "webpack:///./*": "${webRoot}/*",
        "webpack:///src/*": "${webRoot}/*",
        "webpack:///*": "*",
        "webpack:///./~/*": "${webRoot}/node_modules/*",
        "meteor://ğŸ’»app/*": "${webRoot}/*"
      }
    }
  ]
}
```

webpack.dev.js

```javascript
{
  devtool: "source-map",
}
```

react devtool å®‰è£…å¥½å°±è¡Œ, redux devtool éœ€è¦é¢å¤–é…ç½®

[redux-devtools-extension](https://github.com/zalmoxisus/redux-devtools-extension)

If you setup your store with middleware and enhancers, change:

import { createStore, applyMiddleware, compose } from 'redux';

- const composeEnhancers = window.**REDUX_DEVTOOLS_EXTENSION_COMPOSE** || compose;
- const store = createStore(reducer, /_ preloadedState, _/ composeEnhancers(

* const store = createStore(reducer, /_ preloadedState, _/ compose(
  applyMiddleware(...middleware)
  ));
  Note that when the extension is not installed, weâ€™re using Redux compose here.

To specify extensionâ€™s options, use it like so:

const composeEnhancers =
typeof window === 'object' &&
window.**REDUX_DEVTOOLS_EXTENSION_COMPOSE** ?  
 window.**REDUX_DEVTOOLS_EXTENSION_COMPOSE**({
// Specify extensionâ€™s options like name, actionsBlacklist, actionsCreators, serialize...
}) : compose;

const enhancer = composeEnhancers(
applyMiddleware(...middleware),
// other store enhancers if any
);
const store = createStore(reducer, enhancer);
See the post for more details.

é…ç½®å¥½å°±æ­£å¸¸å¯åŠ¨ webpack dev server, å’Œ vscode debugger.

### å•†åº—é¡µé¢é£Ÿå“åˆ—è¡¨, æ¯ä¸ªåˆ—è¡¨å¤´çš„ sticky çŠ¶æ€çš„è¿½è¸ª

è¿½è¸ª sticky çš„ list-header, ç”¨ä»¥åŒæ­¥æ›´æ–° menu çš„é€‰ä¸­çŠ¶æ€.

sticky çŠ¶æ€çš„æ”¹å˜æœ¬èº«æ²¡æœ‰äº‹ä»¶,ä½†æ˜¯æœ‰ä¸ªæ¥å£[IntersectionObserver](https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver), æ˜¯ç”¨æ¥ç›‘æ§ä¸€ä¸ª dom å…ƒç´ çš„å¯è§†çŠ¶æ€çš„,
æ¥å£è¯´æ˜è§[IntersectionObserver API ä½¿ç”¨æ•™ç¨‹](https://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html), ä½†æ˜¯, è¿™ä¸ªæ¥å£æœ¬èº«çš„åŠŸèƒ½ä¸è¶³ä»¥ç›´æ¥ååˆ°ç›‘æ§ sticky çŠ¶æ€çš„æ”¹å˜,
éœ€è¦ä¸€äº› trick, è§[An event for CSS position:sticky](https://developers.google.com/web/updates/2017/09/sticky-headers), ç®€å•çš„è¯´,å°±æ˜¯åœ¨æ¯ä¸ª section çš„å¤´å°¾åŠ ä¸¤ä¸ªä¸å¯è§çš„ div,
é€šè¿‡ç›‘æ§è¿™ä¸¤ä¸ªåŒºåŸŸçš„å¯è§†çŠ¶æ€, å°±å¯ä»¥åˆ¤æ–­å‡ºç°åœ¨çŠ¶æ€ä¸º sticky çš„ header.

æ³¨: è¿™ä¸ªæ¥å£è¿˜å¯ä»¥ç”¨æ¥åšæ‡’åŠ è½½(æ¯”å¦‚æ— å°½ list, ç”¨æ¥åˆ¤æ–­ list çš„åº•éƒ¨æ˜¯å¦åˆ°è¾¾å¯è§†åŒºåŸŸ)

## 2020.8.2

### ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…, åŠ¨æ€å¼•å…¥å’Œæ ·å¼å˜åŒ–çš„é—®é¢˜

åˆæ­¥ç¡®å®šé—®é¢˜å‡ºåœ¨ optimization.splitChunks æ²¡æœ‰é…ç½®å¥½,éœ€è¦å†ç ”ç©¶ä¸€ä¸‹

æ³¨æ„ publicPath çš„é…ç½®, æ²¡æœ‰é…ç½®çš„è¯, è¯·æ±‚ js ä¼šå˜æˆ"/location/city/xxx.js", æ‰€ä»¥å¦‚æœæœåŠ¡å™¨ç«¯é™æ€æ–‡ä»¶æ”¾çš„ä½ç½®æ²¡æœ‰å˜åŒ–çš„è¯, publicPath = "/" å°±è¡Œäº†
